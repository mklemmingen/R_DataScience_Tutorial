---
theme: simplex
title: |
  Interaktives R Tutorial
  DataScience Methoden mit Umfragedaten üìä
author: Marty Lauterbach
output: 
  html_document:
    theme: simplex
    highlight: textmate
    number_sections: TRUE
    toc: true
    toc_depth: 5
    toc_float:
      collapsed: false
      smooth_scroll: true
    smart: true
runtime: shiny_prerendered
description: >
  data science tutorial with collected data about non-key personal information to showcase distribution topics
date: "`r format(Sys.time(), '%d. %B of %Y')`"
---

```{css, echo=FALSE}
#TOC {
  width: 60em;
  white-space: nowrap;
}

div.tocify {
width: 100%;
}

div:has(> #TOC) {
  display: flex;
  flex-direction: row-reverse;
}

.custom-box {
    border: 1px solid #ccc;
    padding: 20px;
    margin: 20px 0;
    background-color: #fff;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    border-radius: 5px;
}
```

```{r setup, include=FALSE}
# Setting up CRAN mirror
options(repos = c(CRAN = "https://cran.r-project.org"))

# Function to install and load packages
install_and_load <- function(package) {
  if (!require(package, character.only = TRUE)) {
    install.packages(package)
    library(package, character.only = TRUE)
  }
}

# Install and load necessary packages
install_and_load("knitr") # For this R Markdown
install_and_load("learnr") # For interactive tutorials
install_and_load("tzdb")  # For time zone database
install_and_load("vroom") # For reading csv files
install_and_load("readr") # for reading csv files
install_and_load("dplyr") # for data wrangling
install_and_load("tidyr") # for data wrangling
install_and_load("curl")  # Install curl package
install_and_load("cli")   # Install cli package
install_and_load("DT") # showcasing tabular data on slider (javascript based)
install_and_load("ggplot2") # for data visualization
install_and_load("plotly") # for data visualization
install_and_load("gapminder") # for data visualization

tutorial_options(
  exercise.timelimit = 60,
  # A simple checker function that just returns the message in the check chunk
  exercise.checker = function(check_code, ...) {
    list(
      message = eval(parse(text = check_code)),
      correct = logical(0),
      type = "info",
      location = "append"
    )
  }
)

knitr::opts_chunk$set(error = TRUE)
```

## Einleitung

**Willkommen zum R-Tutorial: Strukturierte Datenanalyse üéâ**

Wir freuen uns, dass Sie an unserem interaktiven R-Tutorial teilnehmen. 
In diesem Tutorial lernen Sie, wie man strukturierte Daten mit R effizient analysiert ‚Äì 
von der Datenaufbereitung √ºber die Analyse bis hin zur Ergebnispr√§sentation.
Dazu f√ºhren wir Sie anhand unseres selbstst√§ndig erhobenen Datensatzes durch den Prozess der Datenanalyse und erkl√§ren Ihnen
dabei alles, was Sie wissen m√ºssen, um Ihre eigene Datenanalyse 
mit Ihren eigenen Daten durchf√ºhren zu k√∂nnen.
    
**Was ist R?üìà**

R ist eine Programmiersprache und Umgebung, die speziell f√ºr 
statistische Analysen und Datenvisualisierung entwickelt wurde. 
Mit einer riesigen Sammlung von Paketen und Funktionen ist R eines der 
m√§chtigsten Tools f√ºr Datenwissenschaftler, Statistiker und alle, 
die datenbasierte Entscheidungen treffen m√∂chten.
    
**Das k√∂nnen Sie mit R machen:**

- üìä Daten aufbereiten und bereinigen
- üìà Analysen durchf√ºhren, von Mittelwerten bis zur linearen Regression
- üé® Visualisierungen erstellen und interpretieren

**Was erwartet Sie?**

Dieses Tutorial kombiniert Theorie, interaktive Code√ºbungen, Quizfragen und 
externe Ressourcen (z. B. Bilder und Videos). Alles ist darauf ausgelegt, Ihr 
Verst√§ndnis f√ºr Datenanalyse mit R zu vertiefen.
    
### Lernziele üìñ

Am Ende dieses Tutorials werden Sie folgendes erreicht haben:
1. Eine Tabelle und ihre Datentypen kennenlernen
2. Einen Datensatz so bereinigen, dass er f√ºr Analysezwecke nutzbar ist
3. Methoden der sogenannten Datenwissenschaft nutzen, um Eigenschaften, Verteilungen und Wahrscheinlichkeiten zu erhalten
4. Hypothesen des Datensatzes durch diese Methoden √ºberpr√ºfen
5. Ergebnisse durch verschiedene Visualisierungen darstellen

### Ressourcen üõ†Ô∏è

![Hier finden Sie zudem vorab hilfreiche Hinweise und eine grundlegende Einf√ºhrung in die Verwendung von R!](https://www.youtube.com/watch?v=yZ0bV2Afkjc)

Hier finden Sie verschiedene Cheat Sheets, die Ihnen bei der Arbeit mit R helfen k√∂nnen:

F√ºr Datenaufbereitung:
https://rstudio.github.io/cheatsheets/html/tidyr.html

F√ºr Datenanalyse:
https://rstudio.github.io/cheatsheets/html/data-transformation.html

F√ºr Datenvisualisierung:
https://rstudio.github.io/cheatsheets/html/data-visualization.html

Ein gutes Tutorial zu R Markdown, mit dem dieses Tutorial erstellt wurde:
https://bookdown.org/yihui/rmarkdown/

Und wenn Sie internen Zugriff der Hochschule Reutlingen besitzen, k√∂nnen Sie
dieses Tutorial in GitLab finden:
https://gitlab.reutlingen-university.de/lauterba/datascience_project_tutorialwithsurveydata

Lassen Sie uns starten! üöÄ

## Datenbasis 

**Vergleich verschiedener Daten Deutschlandü•® vs. Spanienü•ò**

Wir haben eine Umfrage mit verschiedensten Fragen zum Leben, physischen Merkmalen und pers√∂nlichen Einstellungen √ºber Google Form erstellt. Diese wurden zus√§tzlich ins Spanische √ºbersetzt und an Kontakte der Umfrageersteller in Deutschland und in Spanien verschickt.
    
**Ziel üéØ der Datenerhebung üìù**

Mit dieser Datenerhebung wollen wir verschiedenste Hypothesen zu Unterschieden zwischen dem Lebensstil in Deutschland und Spanien erkunden und gleichzeitig auch bereits vermutete Hypothesen unterst√ºtzen wie z.B. eine kleinere K√∂rpergr√∂√üe der Spanier im Vergleich zu den Deutschen oder eine im Schnitt dunklere Haar- und Augenfarbe.

**Fragen ‚ùì**

Den Teilnehmern wurden Fragen aus den folgenden Themengebieten gestellt:

    
**1. Physische Merkmale:**

  - Haarfarbe

  - Augenfarbe

  - K√∂rpergr√∂√üe

  - Schuhgr√∂√üe
    <br><br>

**2. Lebensstil:**

  - Bildungsabschluss

  - Fleischkonsum

  - Wasserkonsum

  - Lebensmittelkosten

  - Schlafverhalten

  <br><br>
      
**3. Pers√∂nliche Einstellung:**

  - Datenschutz

  - Demokratie

  - Reisen und Tourismus

  - Umweltfreundlichkeit


### Datenquelle üíæ 

[Hier](https://docs.google.com/forms/d/e/1FAIpQLSfP_4VDf5Og2s1fT22KtWmFPsUsf34jxkBICxzUcgryvZL9wg/viewform?usp=sharing) k√∂nnen Sie selbst an der Befragung teilnehmen, und mit Ihren Eingaben die Datenbasis erweitern, mit denen Sie gleich arbeiten werden. 

[Hier](https://docs.google.com/spreadsheets/d/19mfbkTdvnTZIRasMLSm0r6oqkR184K2Uzf6cEHab2Xo/export?format=csv&gid=1421671188) finden Sie einen Link, welcher Ihnen die Ergebnisse der Befragung als .csv-Datei herunterladen l√§sst.

### Hypothese ü§î

  Aus den Ergebnissen haben wir uns f√ºr die weitere √úberpr√ºfung folgende Hypothese √ºberlegt, die wir im sp√§teren Verlauf auf ihre Richtigkeit √ºberpr√ºfen wollen:

<div class="custom-box">
  *Die Wahrscheinlichkeit, dass eine Person mit dem Aufenthaltsland Spanien an 4 oder mehr Tagen pro Woche Fleisch konsumiert, ist um 60% h√∂her als die einer Person mit dem Aufenthaltsland Deutschland.*
</div>


## Datenaufbereitung

### Daten einlesen

#### Einlesen in "data"

<!-- Beschreibe, wie die Daten eingelesen werden und wie Inkonsistenzen und Leerstellen behoben werden. -->

<div class="custom-box">
  Mit dem folgenden Code holen wir uns die .csv der Umfragedaten von extern (google-sheets) und laden diese dann 
  per readr-library mit read_csv in unsere data Variable. Wir setzen show_col_types auf False, um keine unn√∂tigen
  Informationen dar√ºber zu erhalten, wie einzelne Zellen voneinander getrennt sind. 
</div>

```{r}
# Bibliothek, die bereits geladen wurde: readr, dplyr, DT

# Daten von Google Sheets einlesen, da die Umfrage online stattgefunden hat
url <- "https://docs.google.com/spreadsheets/d/19mfbkTdvnTZIRasMLSm0r6oqkR184K2Uzf6cEHab2Xo/export?format=csv"
data <- read_csv(url, show_col_types = FALSE) # Einlesen von google sheets, show_col_types = FALSE, um die csv Attribute nicht anzuzeigen

# Wir geben die Spaltennamen aus
colnames(data)
```

<br><br>

#### Spalten in Deutsch

<div class="custom-box">
  Um mit kurzen pr√§gnanten Spaltennamen arbeiten zu k√∂nnen, √§ndern wir die Namen der einzelnen Spalten zu einem kurzen Wort in Deutsch.
  
  Mit der Library DT erstellen Wir ein View auf unsere Daten mit einem Display, welches Slider erlaubt. 
  Nutzen Sie diesen Slider am unteren Rand der Daten, um Sie zu begutachten. 
</div>

```{r}
# Wir erstellen neue Namen f√ºr die Spalten
new_column_names <- c(
  "Zeitstempel", "Aufenthaltsland", "Haarfarbe", "Haarl√§nge", "Alter", "Geschlecht", 
  "Bildungsabschluss", "Augenfarbe", "Internetnutzung", "Arbeitszeit", "Schlafzeit", 
  "Einschlafzeit", "K√∂rpergr√∂√üe", "Sprachkenntnisse", "Schuhgr√∂√üe", "Fleischkonsum", 
  "Datenschutz", "Reisen", "Demokratie", "Umweltfreundlichkeit", "Wasserkonsum", 
  "Lebensmittelkosten", "Verwirrung", "Ruhepuls", "Blutdruck"
)

# Wir setzen die neuen Spaltennamen als die Spaltennamen des Datensatzes
colnames(data) <- new_column_names

# Wir stellen die ersten 50 Zeilen der Daten dar
datatable(head(data, 50), options = list(scrollX = TRUE))

```

<br><br>

### Datenbereinigung

<br><br>

**F√§llt Ihnen etwas auf?** ü§î
Schauen Sie sich die Daten genau an und √ºberlegen Sie, was bereinigt werden muss, da Personen bei vielen Dingen frei antworten konnten.

In diesem Abschnitt werden wir die drei Methoden `mutate`, `separate` und `filter` verwenden, um unsere Daten zu vereinheitlichen und ggf. zu transformieren:

<br><br>

#### Mutate()

Die mutate-Methode ist mit folgendem Syntax aufgebaut: 

-> mutate(neue_spalte = Funktion(alte_spalte))

Beispiel **mutate**: 
```{r}
# Beispiel-Datensatz
bsp1 <- tibble(
  Name = c("Anna M√ºller", "Bernd Schmidt", "Clara Meier"),
  Alter = c(25, 30, 22),
  Haarlaenge = c("30cm", "45cm", "50cm")
)

# mutate verwenden, um Haarl√§nge zu bereinigen | Tipp: nutzen Sie einen Tibble um die Spalte zu "mutaten"
bsp1 <- bsp1 %>%
  mutate(Haarlaenge = as.integer(gsub("cm", "", Haarlaenge)))

```

```{r question-mutate, echo=FALSE}
question("Was ist das Ergebnis von `Haarlaenge` nach der Bereinigung?",
  answer("cm, cm, cm"),
  answer("cm 30, cm 45, cm 50"),
  answer("30, 45, 50", correct = TRUE),
  answer("30cm, 45cm, 50cm"),
  allow_retry = TRUE
)
```
<br><br>

#### Separate()

Die separate-Methode ist mit folgendem Syntax aufgebaut: 

-> separate(Spalte, into = c("neue_spalte1", "neue_spalte2"), sep = "Trennzeichen")

Beispiel **separate**: 
```{r}
# Beispiel-Datensatz
bsp1 <- tibble(
  Name = c("Anna M√ºller", "Bernd Schmidt", "Clara Meier"),
  Alter = c(25, 30, 22)
)

# separate verwenden, um Name in Vorname und Nachname zu trennen
bsp1 <- bsp1 %>%
  separate(Name, into = c("Vorname", "Nachname"), sep = " ")

```

```{r question-seperate, echo=FALSE}
question("Was ist das Ergebnis von `Name` nach der Trennung?",
  answer("Vorname: Anna, Bernd, Clara Meier"),
  answer("Name: Anna, Bernd, Clara"),
  answer("Vorname: Anna, Bernd, Clara | Nachname: M√ºller, Schmidt, Meier", correct = TRUE),
  answer("Anna M√ºller, Bernd Schmidt, Clara Meier"),
  allow_retry = TRUE
)
```

<br><br>

#### Filter()

Die filter-Methode ist mit folgendem Syntax aufgebaut: 

-> filter(Spalte > Wert)

Beispiel **filter**:
```{r}
# Beispiel-Datensatz
bsp1 <- tibble(
  Vorname = c("Anna", "Bernd", "Clara"),
  Nachname = c("M√ºller", "Schmidt", "Meier"),
  Alter = c(25, 30, 22)
)

# filter verwenden, um Personen √ºber 25 Jahre zu filtern
bsp1 <- bsp1 %>%
  filter(Alter > 25)
```

```{r question-filter, echo=FALSE}
question("Was ist das Ergebnis von `Alter` nach dem Filtern?",
  answer("25, 30, 22"),
  answer("Anna M√ºller, Clara Meier"),
  answer("Anna M√ºller, Bernd Schmidt"),
  answer("Bernd Schmidt", correct = TRUE),
  answer("Bernd Schmidt, 30, Anna M√ºller, 25"),
  allow_retry = TRUE
)
```

<br><br>
<br><br>

### Must-Dos zur Datenaufbereitung

**Nun sind Sie dran! Nutzen Sie die Methoden, um die Spalten zu vereinheitlichen** üöÄ

<br><br>
<br><br>


#### (1) Haarl√§nge

Haarl√§nge in cm | Longitud del cabello en cm
-> Hier m√ºssen wir auf eine Ganzzahl pr√ºfen und die Schreibweise vereinheitlichen, so dass cm nicht mehr Teil der Daten ist.

```{r exercise=TRUE, exercise.eval=FALSE, haarlaenge_bereinigen}
# Aufgabe: Pr√ºfen Sie, ob die Haarl√§nge eine Ganzzahl ist und entfernen Sie "cm" aus den Daten.
data <- data %>%
  # ...user code here...








```

**SPOILER:**
```{r exercise.solution=TRUE, haarlaenge_bereinigen_solution}
# L√∂sung:
data <- data %>%
  mutate(`Haarl√§nge` = as.integer(gsub("cm", "", `Haarl√§nge`)))
```

<br><br>
<br><br>

#### (2) Einschlafzeit

Durchschnittliche Zeit des Einschlafens hhmm | Tiempo promedio para conciliar el sue√±o hhmm
-> Hier ist ganz viel falsch. Viele Leute haben die Frage als "Wie lange brauchen Sie einzuschlafen?" verstanden und die Zeit in Minuten angegeben.
-> Wir sollten in zwei Spalten aufteilen: 1. Wie lange brauchen Sie einzuschlafen? 2. Wann gehen Sie ins Bett? (hh:mm oder hhmm)

```{r einschlafzeit_aufteilen, exercise=TRUE, exercise.eval=FALSE}
# Aufgabe: Teilen Sie die Spalte in zwei Spalten auf: 1. Wie lange brauchen Sie einzuschlafen? 2. Wann gehen Sie ins Bett?
library(tidyr)
data <- data %>%
  # ...Ihr code hier ..







```


**SPOILER:**
```{r exercise.solution=TRUE, einschlafzeit_aufteilen_solution}
# L√∂sung:
data <- data %>%
  separate(`Einschlafzeit`, 
           into = c("Einschlafzeit_Minuten", "Bettgehzeit_hhmm"), 
           sep = " ", 
           convert = TRUE)
```

<br><br>
<br><br>

#### (3) K√∂rpergr√∂√üe

K√∂rpergr√∂√üe in cm | Altura en cm 
-> Hier m√ºssen wir auf eine Ganzzahl im Bereich von 100 bis 250 pr√ºfen und die Schreibweise vereinheitlichen.

```{r koerpergroesse_bereinigen, exercise=TRUE, exercise.eval=FALSE}
# Aufgabe: Pr√ºfen Sie, ob die K√∂rpergr√∂√üe eine Ganzzahl im Bereich von 100 bis 250 ist und vereinheitlichen Sie die Schreibweise.
data <- data %>%
  # ...Ihr code hier ...







```


**SPOILER:**
```{r exercise.solution=TRUE, koerpergroesse_bereinigen_solution}
# L√∂sung:
data <- data %>%
  mutate(`K√∂rpergr√∂√üe` = as.integer(`K√∂rpergr√∂√üe`)) %>%
  filter(`K√∂rpergr√∂√üe` >= 100 & `K√∂rpergr√∂√üe` <= 250)
```

<br><br>
<br><br>

#### (4) Lebensmittelkosten

Wie viel Euro/ Monat f√ºr Lebensmittel geben Sie p.P. aus? | ¬øCu√°ntos euros al mes gasta en alimentos por persona? 
-> Hier haben viele Personen ein Eurozeichen oder ein "eur" hinter oder vor der Zahl geschrieben.

```{r exercise=TRUE, exercise.eval=FALSE, lebensmittelkosten_bereinigen}
# Aufgabe: Entfernen Sie alle fremden strings aus den Daten, die keine zusammenh√§ngende Zahl ist.
data <- data %>%
  # ...Ihr code hier ...







```


**SPOILER:**
```{r exercise.solution=TRUE, lebensmittelkosten_bereinigen_solution}
# L√∂sung:
data <- data %>%
  mutate(`Lebensmittelkosten` = 
           as.numeric(gsub("[^0-9.]", "", `Lebensmittelkosten`)))
```

<br><br>
<br><br>

#### (5) Blutdruck

(optional) Was ist Ihr durchschnittlicher Blutdruck in systolischer Wert/diastolischer Wert? | (opcional) ¬øCu√°l es su presi√≥n arterial promedio en valor sist√≥lico/valor diast√≥lico? 
-> Hier m√ºssen wir die Werte in zwei Spalten aufteilen, und die Schreibweise vereinheitlichen, damit die deutschen Werte (z.B:. 120/80) den spanischen Werten angepasst sind (z.B.: 12/8). 

```{r exercise=TRUE, exercise.eval=FALSE, blutdruck_bereinigen}
# Aufgabe: Teilen Sie die Spalte in zwei Spalten auf: systolischer Wert und diastolischer Wert.
data <- data %>%
  # ...Ihr code hier ...







```


**SPOILER:**
```{r exercise.solution=TRUE, blutdruck_bereinigen_solution}
# L√∂sung:
data <- data %>%
  separate(`Blutdruck`, 
           into = c("Blutdruck_systolisch", "Blutdruck_diastolisch"), 
           sep = "/", 
           convert = TRUE) %>%
  mutate(
    Blutdruck_systolisch = ifelse(Blutdruck_systolisch < 100, Blutdruck_systolisch * 10, Blutdruck_systolisch),
    Blutdruck_diastolisch = ifelse(Blutdruck_diastolisch < 25, Blutdruck_diastolisch * 10, Blutdruck_diastolisch)
  )
```

## Datenanalyse

### Methoden der Data Science 

<!-- Beschreibe Mittelwert, Median, Varianz, Standardabweichung, lineare Regression und Hypothesentests. -->
<!-- Einlesen des Datensatzes und Methoden nacheinander durch --> 

#### Mittelwert

Der Mittelwert ist der Durchschnitt aller Werte in einer Datenreihe. Er wird berechnet, indem alle Werte addiert und durch die Anzahl der Werte geteilt werden.

```{r}
# Berechnung des Mittelwerts der K√∂rpergr√∂√üe
mean(data$K√∂rpergr√∂√üe)
```
<br><br>

#### Median

Der Median ist der Wert, der die Datenreihe in zwei gleich gro√üe Teile teilt. Er wird berechnet, indem die Werte sortiert und der mittlere Wert ausgew√§hlt wird.

```{r}
# Berechnung des Medians der K√∂rpergr√∂√üe
median(data$K√∂rpergr√∂√üe)
```
<br><br>

#### Varianz

Die Varianz ist ein Ma√ü f√ºr die Streuung der Daten um den Mittelwert. Sie wird berechnet, indem die quadrierten Abweichungen der Werte vom Mittelwert summiert und durch die Anzahl der Werte geteilt werden.

```{r}
# Berechnung der Varianz der K√∂rpergr√∂√üe
var(data$K√∂rpergr√∂√üe)
```
<br><br>

#### Standardabweichung

Die Standardabweichung ist die Quadratwurzel der Varianz und gibt an, wie weit die Werte von ihrem Mittelwert entfernt sind.

```{r}
# Berechnung der Standardabweichung der K√∂rpergr√∂√üe
sd(data$K√∂rpergr√∂√üe)
```
<br><br>

#### Lineare Regression

Die lineare Regression ist eine Methode zur Modellierung des Zusammenhangs zwischen einer abh√§ngigen und einer oder mehreren unabh√§ngigen Variablen. Sie wird verwendet, um den Einfluss der unabh√§ngigen Variablen auf die abh√§ngige Variable zu sch√§tzen.

```{r}
# Lineare Regression der K√∂rpergr√∂√üe in Abh√§ngigkeit vom Alter
lm(data$K√∂rpergr√∂√üe ~ data$Schuhgr√∂√üe)

# einfacher plot, um prinzip zu visualisieren
plot(data$Schuhgr√∂√üe, data$K√∂rpergr√∂√üe)
abline(lm(data$K√∂rpergr√∂√üe ~ data$Schuhgr√∂√üe), col = "red")
```
<br><br>

#### Hypothesentests

Hypothesentests sind statistische Tests, die verwendet werden, um zu √ºberpr√ºfen, ob eine Hypothese √ºber eine Population wahr ist. Sie basieren auf der Annahme, dass die Daten zuf√§llig aus einer bestimmten Verteilung stammen.

Hier l√∂sen wir eine relativ einfache Hypothese, die wir uns f√ºr die Daten √ºberlegt haben, bevor wir die gr√∂√üere Hypothese √ºberpr√ºfen.

**Hypothese: Die Wahrscheinlichkeit, dass eine Person aus Spanien braune Augen hat, ist um 20% h√∂her als die Wahrscheinlichkeit, dass eine Person aus Deutschland braune Augen hat.**
```{r}
# 1. Hypothesen aufstellen (Ho, Ha)

  # H0: Die Wahrscheinlichkeit, dass eine Person aus Spanien braune Augen hat, ist gleich der Wahrscheinlichkeit, dass eine Person aus Deutschland braune Augen hat.
  # Ha: Die Wahrscheinlichkeit, dass eine Person aus Spanien braune Augen hat, ist um 20% h√∂her als die Wahrscheinlichkeit, dass eine Person aus Deutschland braune Augen hat.

# 2. Vertrauenswahrscheinlichkeit festlegen

  # Vertrauenswahrscheinlichkeit: 95%
  # Das bedeutet, dass wir zu 95% sicher sein wollen, dass unser Ergebnis korrekt ist.
  # Signifikanzniveau: 5%
  # Das Signifikanzniveau von 5% (0,05) bedeutet, dass wir bereit sind, ein 5%iges Risiko einzugehen, die Nullhypothese f√§lschlicherweise abzulehnen.
  # Obwohl die Alternativhypothese (Ha) eine 20% h√∂here Wahrscheinlichkeit angibt, bleibt das Signifikanzniveau bei 5%, um die Strenge des Tests zu gew√§hrleisten.

# 3. Passende Teststatistik heraussuchen

Personen <- data %>%
  filter(Aufenthaltsland %in% c("Deutschland", "Spanien")) %>%
  count(Aufenthaltsland, Augenfarbe) %>%
  pivot_wider(names_from = Augenfarbe, values_from = n, values_fill = list(n = 0))

# 4. Testgr√∂√üe t mit der Teststatistik berechnen

# Wir verwenden den Chi-Quadrat-Test, weil wir zwei kategoriale Variablen haben (Aufenthaltsland und Augenfarbe) und pr√ºfen wollen, ob es einen signifikanten Unterschied in der Verteilung der Augenfarben zwischen den beiden L√§ndern gibt.
chisq_test_result <- chisq.test(Personen[, -1])

# 5. Interpretation des Ergebnisses

if (chisq_test_result$p.value < 0.05) {
  interpretation <- "Da der p-Wert kleiner als das Signifikanzniveau ist, lehnen wir die Nullhypothese ab und akzeptieren die Alternativhypothese. Das hei√üt, die Wahrscheinlichkeit, dass eine Person aus Spanien braune Augen hat, ist um 20% h√∂her als die Wahrscheinlichkeit, dass eine Person aus Deutschland braune Augen hat."
} else {
  interpretation <- "Da der p-Wert gr√∂√üer als das Signifikanzniveau ist, k√∂nnen wir die Nullhypothese nicht ablehnen. Das hei√üt, die Wahrscheinlichkeit, dass eine Person aus Spanien braune Augen hat, ist nicht um 20% h√∂her als die Wahrscheinlichkeit, dass eine Person aus Deutschland braune Augen hat."
}

interpretation
```
<br><br>

**Erkl√§rung der Schritte:**

**Hypothesen aufstellen:** Wir formulieren die Nullhypothese (H0) und die Alternativhypothese (Ha). H0 besagt, dass es keinen Unterschied in der Wahrscheinlichkeit gibt, w√§hrend Ha besagt, dass die Wahrscheinlichkeit in Spanien um 20% h√∂her ist.

**Vertrauenswahrscheinlichkeit und Signifikanzniveau festlegen:** Wir w√§hlen eine Vertrauenswahrscheinlichkeit von 95%, was einem Signifikanzniveau von 5% entspricht. Dies bedeutet, dass wir ein 5%iges Risiko akzeptieren, die Nullhypothese f√§lschlicherweise abzulehnen.

**Passende Teststatistik heraussuchen:** Wir verwenden den Chi-Quadrat-Test, da wir zwei kategoriale Variablen haben und die Verteilung der Augenfarben zwischen den beiden L√§ndern vergleichen m√∂chten.

**Testgr√∂√üe berechnen:** Wir f√ºhren den Chi-Quadrat-Test durch und berechnen den p-Wert.

**Ergebnis interpretieren:** Basierend auf dem p-Wert entscheiden wir, ob wir die Nullhypothese ablehnen oder nicht. Wenn der p-Wert kleiner als 0.05 ist, lehnen wir die Nullhypothese ab und akzeptieren die Alternativhypothese.
<br><br>

### Quizfragen

```{r question-mittelwert, echo=FALSE}
question("Was ist der Mittelwert der K√∂rpergr√∂√üe?",
  answer("170", correct = TRUE),
  answer("180"),
  answer("160"),
  answer("190"),
  allow_retry = TRUE
)
```

```{r question-median, echo=FALSE}
question("Was ist der Median der K√∂rpergr√∂√üe?",
  answer("170", correct = TRUE),
  answer("180"),
  answer("160"),
  answer("190"),
  allow_retry = TRUE
)

```

```{r question-varianz, echo=FALSE}
question("Was ist die Varianz der K√∂rpergr√∂√üe?",
  answer("100"),
  answer("200"),
  answer("150", correct = TRUE),
  answer("250"),
  allow_retry = TRUE
)

```

```{r question-varianz-bedeutung, echo=FALSE}
question("Welche Bedeutung hat die richtige Varianz?",
  answer("Die Daten sind eher homogen (Elemente darin √§hnlich)"),
  answer("Die Daten sind eher heterogen (Elemente darin unterschiedlich)", correct = TRUE),
  allow_retry = TRUE
)
```

```{r question-standardabweichung, echo=FALSE}
question("Was ist die Standardabweichung der K√∂rpergr√∂√üe?",
  answer("12", correct = TRUE),
  answer("20"),
  answer("15"),
  answer("25"),
  allow_retry = TRUE
)

```

```{r question-lineare-regression, echo=FALSE}
question("Was ist der Zusammenhang zwischen K√∂rpergr√∂√üe und Schuhgr√∂√üe?",
  answer("Es gibt keinen Zusammenhang"),
  answer("Es gibt einen positiven Zusammenhang", correct = TRUE),
  answer("Es gibt einen negativen Zusammenhang"),
  allow_retry = TRUE
)
```

<br><br>
<br><br>
<br><br>

### Gro√üer Hypothesentest

<!-- F√ºhre Hypothesentests durch, um deine Hypothese zu √ºberpr√ºfen. -->
<!-- 1. Hypothesen aufstellen (Ho, Ha)
    2. Vertrauenswahrscheinlichkeit festlegen
    3. passende Teststatistik heraussuchen
    4. Testgr√∂√üe t mittle Teststatistik berechnen
    5. Interpretation des Ergebnisses -->

Jetzt √ºberpr√ºfen Wir unsere am Anfang des Tutorials aufgestellte Hypothese, die besagt, dass:



**Hypothese: Die Wahrscheinlichkeit, dass eine Person mit dem Aufenthaltsland Spanien an 4 oder mehr Tagen Pro Woche Fleisch konsumiert ist um 60% h√∂her, als die einer Person mit dem Aufenthaltsland Deutschland.**

```{r}
#Hypothesen aufstellen (Ho, Ha)
#Nullhypothese (H‚ÇÄ): Die Wahrscheinlichkeit, dass eine Person in Spanien an 4 oder mehr Tagen pro Woche Fleisch konsumiert, ist nicht um 60% h√∂her als die einer Person in Deutschland.
#Alternativhypothese (H‚Çê): Die Wahrscheinlichkeit, dass eine Person in Spanien an 4 oder mehr Tagen pro Woche Fleisch konsumiert, ist um 60% h√∂her als die einer Person in Deutschland. 

# 2. Vertrauenswahrscheinlichkeit festlegen
# Vertrauenswahrscheinlichkeit: 95%
  # Das bedeutet, dass wir zu 95% sicher sein wollen, dass unser Ergebnis korrekt ist.
  # Signifikanzniveau: 5%

```

```{r question-significant, echo=FALSE}
question("Das Signifikanzniveau von 5% (0,05) bedeutet, dass...",
  answer("...wir bereit sind, ein 5%iges Risiko einzugehen, die Nullhypothese f√§lschlicherweise anzunehmen."),
  answer("...wir bereit sind, ein 5%iges Risiko einzugehen, die Alternativhypothese f√§lschlicherweise anzunehmen."),
  answer("...wir bereit sind, ein 5%iges Risiko einzugehen, die Nullhypothese f√§lschlicherweise abzulehnen.", correct = TRUE),
  answer("...wir bereit sind, ein 5%iges Risiko einzugehen, die Alternativhypothese f√§lschlicherweise abzulehnen."),
  allow_retry = TRUE
)
```

```{r}

#3. Passende Teststatistik heraussuchen
#Wir verwenden den Z-Test f√ºr zwei Anteilswerte, da es sich um den Vergleich zweier Wahrscheinlichkeiten handelt.

#4. Testgr√∂√üe t mit der Teststatistik berechnen
# Filter f√ºr Aufenthaltsland und Fleischkonsum

```


```{r setupA}
url <- "https://docs.google.com/spreadsheets/d/19mfbkTdvnTZIRasMLSm0r6oqkR184K2Uzf6cEHab2Xo/export?format=csv"
hypo_data <- read_csv(url, show_col_types = FALSE)
new_column_names <- c(
  "Zeitstempel", "Aufenthaltsland", "Haarfarbe", "Haarl√§nge", "Alter", "Geschlecht", 
  "Bildungsabschluss", "Augenfarbe", "Internetnutzung", "Arbeitszeit", "Schlafzeit", 
  "Einschlafzeit", "K√∂rpergr√∂√üe", "Sprachkenntnisse", "Schuhgr√∂√üe", "Fleischkonsum", 
  "Datenschutz", "Reisen", "Demokratie", "Umweltfreundlichkeit", "Wasserkonsum", 
  "Lebensmittelkosten", "Verwirrung", "Ruhepuls", "Blutdruck"
)
colnames(hypo_data) <- new_column_names

```

```{r fleisch_filter, exercise=TRUE, exercise.setup = "setupA"}
# Aufgabe: 'Fleischkonsum_4plus' ist 1, wenn 'Fleischkonsum' 4 oder mehr Tage betr√§gt, und 0 andernfalls.
#Tip: mutate(Fleischkonsum_4plus = )
hypo_data <- hypo_data %>%

```

```{r fleisch_filter-solution}
hypo_data <- hypo_data %>%
  mutate(Fleischkonsum_4plus = ifelse(Fleischkonsum >= 4, 1, 0))

```


```{r fleisch_filter-check}
"Richtig!"
```

```{r setupB, exercise.setup = "setupA"}
hypo_data <- hypo_data %>%
  mutate(Fleischkonsum_4plus = ifelse(Fleischkonsum >= 4, 1, 0))

```

```{r land_filter, exercise=TRUE, exercise.setup = "setupB"}

#Aufgabe: Filtere hypo_data pro Aufenthaltsland
spanien <- hypo_data %>% 
deutschland <- hypo_data %>% 

```

```{r land_filter-solution}
spanien <- hypo_data %>% filter(Aufenthaltsland == "Spanien | Espa√±a")
deutschland <- hypo_data %>% filter(Aufenthaltsland == "Deutschland")

```

```{r land_filter-check}
"Richtig!"
```

```{r setupC, exercise.setup = "setupB"}
spanien <- hypo_data %>% filter(Aufenthaltsland == "Spanien | Espa√±a")
deutschland <- hypo_data %>% filter(Aufenthaltsland == "Deutschland")

```

```{r wahrscheinlich, exercise=TRUE, exercise.setup = "setupC"}

# Aufgabe: Berechnung der Wahrscheinlichkeiten f√ºr Spanien und Deutschland
p_spanien <- 
p_deutschland <- 

```

```{r wahrscheinlich-solution}
p_spanien <- mean(spanien$Fleischkonsum_4plus)
p_deutschland <- mean(deutschland$Fleischkonsum_4plus)

```

```{r wahrscheinlich-check}
"Richtig!"
```

```{r setupD, exercise.setup = "setupC"}
p_spanien <- mean(spanien$Fleischkonsum_4plus)
p_deutschland <- mean(deutschland$Fleischkonsum_4plus)

```

```{r n, exercise=TRUE, exercise.setup = "setupD"}

# Aufgabe: Geben Sie jeweils die Anzahl der Personen an
#Tip: Benutzen Sie nrow()
n_spanien <-
n_deutschland <- 

```

```{r n-solution}
n_spanien <- nrow(spanien)
n_deutschland <- nrow(deutschland)

```

```{r n-check}
"Richtig!"
```

```{r setupE, exercise.setup = "setupD"}
n_spanien <- nrow(spanien)
n_deutschland <- nrow(deutschland)

```

```{r standard, exercise=TRUE, exercise.setup = "setupE"}

# Aufgabe:Berechne den Standardfehler f√ºr den Unterschied der beiden Wahrscheinlichkeiten
se <- 

```

```{r standard-solution}
se <- sqrt(p_deutschland * (1 - p_deutschland) / n_deutschland +
           p_spanien * (1 - p_spanien) / n_spanien)

```

```{r standard-check}
"Richtig!"
```

```{r setupF, exercise.setup = "setupE"}
se <- sqrt(p_deutschland * (1 - p_deutschland) / n_deutschland +
           p_spanien * (1 - p_spanien) / n_spanien)

```

```{r p_val, exercise=TRUE, exercise.setup = "setupF"}
# Aufgabe:
# Differenz in Wahrscheinlichkeiten
p_diff <- 
# Berechnet den Z-Wert (Teststatistik) basierend auf der Differenz der Proportionen und dem Standardfehler.
z <- p_diff / se
# Berechnet den P-Wert f√ºr den einseitigen Z-Test.
p_value <- 1 - pnorm(z)  # Rechtseitiger Test

```

```{r p_val-solution}
# Differenz in Wahrscheinlichkeiten
p_diff <- p_spanien - 1.6 * p_deutschland 
# Berechnet den Z-Wert (Teststatistik) basierend auf der Differenz der Proportionen und dem Standardfehler.
z <- p_diff / se
# Berechnet den P-Wert f√ºr den einseitigen Z-Test.
p_value <- 1 - pnorm(z)  # Rechtseitiger Test

```

```{r p_val-check}
"Richtig!"
```

```{r setupG, exercise.setup = "setupF"}
p_diff <- p_spanien - 1.6 * p_deutschland
z <- p_diff / se
p_value <- 1 - pnorm(z)

```

```{r result, exercise=TRUE, exercise.setup = "setupG"}
# Aufgabe: Vervollst√§ndige die Ausgabe
# Ergebnis ausgeben
cat("P(Spanien):", , "\n")
cat("P(Deutschland):", , "\n")
cat("Z-Wert:", , "\n")
cat("P-Wert:", , "\n")

# Entscheidung treffen
if () {
  cat("Ergebnis: Wir lehnen die Nullhypothese H0 ab. Die Wahrscheinlichkeit in Spanien ist signifikant h√∂her.\n")
} else {
  cat("Ergebnis: Wir k√∂nnen die Nullhypothese H0 nicht ablehnen.\n")
}

```

```{r result-solution}
# Ergebnis ausgeben
cat("P(Spanien):", p_spanien, "\n")
cat("P(Deutschland):", p_deutschland, "\n")
cat("Z-Wert:", z, "\n")
cat("P-Wert:", p_value, "\n")

# Entscheidung treffen
if (p_value < 0.05) {
  cat("Ergebnis: Wir lehnen die Nullhypothese H0 ab. Die Wahrscheinlichkeit in Spanien ist signifikant h√∂her.\n")
} else {
  cat("Ergebnis: Wir k√∂nnen die Nullhypothese H0 nicht ablehnen.\n")
}

```

```{r result-check}
"Richtig!"
```


```{r question-end, echo=FALSE}
question("Wenn wir H0 nicht ablenen k√∂nnen bedeutet das, dass... ",
  answer("...die Wahrscheinlichkeit, dass eine Person in Spanien an 4 oder mehr Tagen pro Woche Fleisch konsumiert, ist nicht um 60 % h√∂her als die Wahrscheinlichkeit in Deutschland.", correct = TRUE),
  answer("...die Wahrscheinlichkeit, dass eine Person in Spanien an 4 oder mehr Tagen pro Woche Fleisch konsumiert, ist um 60 % h√∂her als die Wahrscheinlichkeit in Deutschland."),
  answer("...wir keine Aussage treffen k√∂nnen."),
  allow_retry = TRUE
)
```


## Ergebnispr√§sentation

### Visualisierungen

<!-- Erstelle mindestens 3-4 Grafiken, um die Ergebnisse darzustellen. -->

Im Folgenden wird die Visualisierung via ggplot erkl√§rt. Danach wird ggplot angewendet, um die Hypothese zu visualisieren, sowie bestimmte Umfragedaten zwischen den L√§ndern visuell zu vergleichen.

<br><br>

#### Erkl√§rung von ggplot

`ggplot2` ist eine der beliebtesten Bibliotheken in R f√ºr die Datenvisualisierung. Es basiert auf dem Grammar of Graphics, einem Konzept zur Beschreibung von Grafiken durch Komponenten wie Daten, 
√Ñsthetik und Geometrie.

Die grundlegende Struktur eines `ggplot`-Befehls besteht aus folgenden Elementen:

1. `ggplot()`: Erstellt ein leeres Koordinatensystem.
2. `aes()`: Definiert die Zuordnung von Daten zu visuellen Eigenschaften wie x- und y-Achse, Farbe und Gr√∂√üe.
3. `geom_*()`: F√ºgt geometrische Objekte wie Punkte, Linien und Balken hinzu
4. `labs()`: F√ºgt Titel und Achsenbeschriftungen hinzu
5. `theme()`: √Ñndert das Erscheinungsbild des Diagramms

**Im Folgenden Block d√ºrfen Sie selbst versuchen, eine Visualisierung zu erstellen.**

```{r, exercise=TRUE, exercise.eval=FALSE, pointless_plot}

# Viel Erfolg!
# *ihr code hier*

```
<br><br>

**Falls Sie die derzeitigen data sehen wollen:**
```{r}	
# Wir stellen die ersten 50 Zeilen der Daten dar
datatable(head(data, 50), options = list(scrollX = TRUE))
```

<br><br>
<br><br>

#### Visualisierung der Hypothese

```{r}
# Bibliothek, die bereits geladen wurde: ggplot2

# Plot 1 ohne Filter
ggplot(data, aes(x = Aufenthaltsland, fill = factor(Fleischkonsum))) +
  geom_bar(position = "dodge", alpha = 0.7) +
  labs(title = "Balkendiagramm des Fleischkonsums nach Aufenthaltsland",
       x = "Aufenthaltsland",
       y = "Anzahl der Personen",
       fill = "Fleischkonsum") +
  theme_minimal()

# Plot 2 mit Filter
# Neue Spalte erstellen, die angibt, ob der Fleischkonsum >= 4 Tage pro Woche ist
data$Fleischkonsum_4plus <- data$Fleischkonsum >= 4

# Gruppieren und Prozentsatz berechnen
proportion_df <- data %>%
  group_by(Aufenthaltsland) %>%
  summarise(Prozent = mean(Fleischkonsum_4plus) * 100)

# Visualisierung mit ggplot2
  ggplot(proportion_df, aes(x = Aufenthaltsland, y = Prozent, fill = Aufenthaltsland)) +
  geom_bar(stat = "identity") +
  geom_text(aes(label = sprintf("%.1f%%", Prozent)), vjust = -0.5, size = 5) +
  labs(title = "% d. Pers., die 4 oder mehr Tagen p. Woche Fleisch kons.",
       x = "Aufenthaltsland",
       y = "Prozentsatz") +
  ylim(0, 100) +
  theme_minimal()

# plotly visualisierung, um die Grafik interaktiv und weiter informierend zu gestalten

p <- data %>%
  filter(Fleischkonsum >= 4) %>%
  ggplot(aes(K√∂rpergr√∂√üe, Schuhgr√∂√üe, size = Lebensmittelkosten, color=Aufenthaltsland)) +
  geom_point() +
  scale_x_log10() +
  theme_bw()
 
ggplotly(p)

```

<br><br>
<br><br>

#### Sammlung von Plots

<br><br>

```{r}
# Bibliothek, die bereits geladen wurde: ggplot2

# Wir erstellen ein Histogramm der K√∂rpergr√∂√üe
ggplot(data, aes(x = K√∂rpergr√∂√üe, fill = Aufenthaltsland)) +
  geom_histogram(binwidth = 5, position = "dodge", alpha = 0.7) +
  labs(title = "Histogramm der K√∂rpergr√∂√üe nach Aufenthaltsland",
       x = "K√∂rpergr√∂√üe (cm)",
       y = "Anzahl der Personen") +
  theme_minimal()

# Wir erstellen ein Boxplot der Lebensmittelkosten
ggplot(data, aes(x = Aufenthaltsland, y = Lebensmittelkosten, fill = Aufenthaltsland)) +
  geom_boxplot(alpha = 0.7,  color = "Good Sir") +
  labs(title = "Boxplot der Lebensmittelkosten nach Aufenthaltsland",
       x = "Aufenthaltsland",
       y = "Lebensmittelkosten (Euro pro Monat)") +
  theme_minimal()

# Wir erstellen ein Streudiagramm der K√∂rpergr√∂√üe und Schuhgr√∂√üe
ggplot(data, aes(x = K√∂rpergr√∂√üe, y = Schuhgr√∂√üe, color = Aufenthaltsland)) +
  geom_point(alpha = 0.7) +
  labs(title = "Streudiagramm der K√∂rpergr√∂√üe und Schuhgr√∂√üe nach Aufenthaltsland",
       x = "K√∂rpergr√∂√üe (cm)",
       y = "Schuhgr√∂√üe") +
  theme_minimal()

# Wir erstellen ein Histogramm der Augenfarbe
ggplot(data, aes(x = Augenfarbe, fill = Aufenthaltsland)) +
  geom_bar(position = "dodge", alpha = 0.7) +
  labs(title = "Histogramm der Augenfarbe nach Aufenthaltsland",
       x = "Augenfarbe",
       y = "Anzahl der Personen") +
  theme_minimal()

# Wir erstellen ein Histogramm der Datenschutz-Antworten
ggplot(data, aes(x = Datenschutz, fill = Aufenthaltsland)) +
  geom_bar(position = "dodge", alpha = 0.7) +
  labs(title = "Histogramm der Datenschutz-Antworten nach Aufenthaltsland",
       x = "Datenschutz",
       y = "Anzahl der Personen") +
  theme_minimal()

```
